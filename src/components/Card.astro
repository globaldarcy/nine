---
import Item from "../components/item.astro";
---

<div class="product">
    <nav>
        <ul class="nav-list">
            <li class="nav-item">Home</li>
            <li class="nav-item">AboutServicesServices</li>
            <li class="nav-item active">ServicesServicesServices</li>
            <li class="nav-item">Contact</li>
        </ul>
        <div class="slider"></div>
    </nav>
    <div class="swiper parentSwiper">
        <div class="swiper-wrapper">
            <div class="swiper-slide parent-slide1">
                <div class="parent-slide-item">
                    <div class="banner swiper-no-swiping">
                        <img src="https://picsum.photos/800/200?random=1" alt="" />
                    </div>
                    <div class="swiper kidSwiper1">
                        <div class="swiper-wrapper">
                            <div class="swiper-slide">
                                <div class="items">
                                    <Item num="1" />
                                    <Item num="2" />
                                    <Item num="3" />
                                </div>
                            </div>
                            <div class="swiper-slide">
                                <div class="items">
                                    <Item num="21" />
                                    <Item num="22" />
                                </div>
                            </div>
                            <div class="swiper-slide">
                                <div class="items">
                                    <Item num="31" />
                                    <Item num="32" />
                                    <Item num="33" />
                                </div>
                            </div>
                            <div class="swiper-slide">
                                <div class="items">
                                    <Item num="41" />
                                    <Item num="42" />
                                    <Item num="43" />
                                    <Item num="44" />
                                </div>
                            </div>
                            <div class="swiper-slide">
                                <div class="items">
                                    <Item num="51" />
                                    <Item num="52" />
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="swiper-slide parent-slide2">
                <div class="parent-slide-item">
                    <div class="banner swiper-no-swiping">
                        <img src="https://picsum.photos/800/200?random=2" alt="" />
                    </div>
                    <div class="swiper kidSwiper2">
                        <div class="swiper-wrapper">
                            <div class="swiper-slide">
                                <div class="items">
                                    <Item num="11" />
                                    <Item num="12" />
                                    <Item num="13" />
                                </div>
                            </div>
                            <div class="swiper-slide">
                                <div class="items">
                                    <Item num="121" />
                                    <Item num="122" />
                                </div>
                            </div>
                            <div class="swiper-slide">
                                <div class="items">
                                    <Item num="131" />
                                    <Item num="132" />
                                    <Item num="133" />
                                </div>
                            </div>
                            <div class="swiper-slide">
                                <div class="items">
                                    <Item num="141" />
                                    <Item num="142" />
                                    <Item num="143" />
                                    <Item num="144" />
                                </div>
                            </div>
                            <div class="swiper-slide">
                                <div class="items">
                                    <Item num="151" />
                                    <Item num="152" />
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="swiper-pagination"></div>
    </div>
</div>
<style lang="scss">
    @import "../styles/_common.scss";
    .product {
        position: relative;
        overflow: hidden;
        background-color: #000;
        transition: background-color 0.3s ease;
        &.bg-white {
            background-color: #fff;
        }
        .parentSwiper {
            // width: vw(1560);
        }
        .kidSwiper1 {
            margin: 0 vw(-50);
        }
        .kidSwiper2 {
            margin: 0 vw(-50);
        }
        .swiper-slide {
            flex-shrink: 1;
        }
        .items {
            display: flex;
        }
        .parent-slide1 {
            padding-left: vw(200);
            position: static;
            &::after {
                content: "";
                z-index: -1;
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background-color: #000;
                // transform: scale(5);
            }
        }
        .parent-slide2 {
            padding-right: vw(200);
            position: static;
            &::after {
                content: "";
                z-index: -2;
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background-color: #fff;
                // transform: scale(5);
            }
        }
        .parent-slide-item {
            margin: 0 vw(50);
            overflow: hidden;
        }
        .banner {
            padding: vw(50) 0;
            width: 100%;
        }
    }
    nav {
        position: relative;
        width: 100%;
        background-color: #333;
    }

    .nav-list {
        z-index: 2;
        position: relative;
        list-style-type: none;
        margin: 0;
        padding: 0;
        display: flex;
    }

    .nav-item {
        padding: 15px 20px;
        color: white;
        cursor: pointer;
        position: relative;
    }

    .slider {
        z-index: 1;
        position: absolute;
        top: 0;
        left: 0;
        width: 0;
        height: 100%;
        background-color: #f39c12;
        transition: all 0.3s ease;
    }
</style>

<script>
    import Swiper from "swiper";
    document.addEventListener("DOMContentLoaded", function () {
        const navItems = document.querySelectorAll(".nav-item");
        const slider = document.querySelector(".slider") as HTMLDivElement;

        function moveSliderToElement(element: HTMLElement) {
            const itemRect = element.getBoundingClientRect();
            const navRect = (element.parentElement as HTMLElement).getBoundingClientRect();

            slider.style.width = `${itemRect.width}px`;
            slider.style.left = `${itemRect.left - navRect.left}px`;
        }

        function setActiveElement(element: HTMLElement) {
            navItems.forEach((item) => item.classList.remove("active"));
            element.classList.add("active");
        }
        navItems.forEach((item) => {
            item.addEventListener("mouseenter", function () {
                moveSliderToElement(item as HTMLElement);
            });

            item.addEventListener("mouseleave", function () {
                const activeElement = document.querySelector(".nav-item.active") as HTMLElement;
                if (activeElement) {
                    moveSliderToElement(activeElement);
                }
            });

            item.addEventListener("click", function () {
                setActiveElement(item as HTMLElement);
                moveSliderToElement(item as HTMLElement);
            });
        });
        // Move the slider to the initially active element
        const initialActiveElement = document.querySelector(".nav-item.active") as HTMLElement;
        if (initialActiveElement) {
            moveSliderToElement(initialActiveElement);
        }

        var parent_Swiper = new Swiper(".parentSwiper", {
            speed: 2000,
            slidesPerView: 1.1,
            resistanceRatio: 0,
            noSwiping: true,
            pagination: {
                el: ".swiper-pagination",
                clickable: true,
            },
            on: {
                slideChange: function () {
                    if (this.activeIndex == 1) {
                        document.querySelector(".product").classList.add("bg-white");
                    } else {
                        document.querySelector(".product").classList.remove("bg-white");
                    }
                },
            },
        });
        var kid_Swiper1 = new Swiper(".kidSwiper1", {
            slidesPerView: "auto",
            nested: true,
            resistanceRatio: 0,
            freeMode: {
                enabled: true,
                momentumBounce: false,
            },
        });
        var kid_Swiper2 = new Swiper(".kidSwiper2", {
            slidesPerView: "auto",
            nested: true,
            resistanceRatio: 0,
            freeMode: {
                enabled: true,
                momentumBounce: false,
            },
        });
    });
</script>
